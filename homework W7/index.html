<script src="https://d3js.org/d3.v5.js"></script>
<script src="https://d3js.org/d3-array.v1.min.js"></script>
<script src="https://d3js.org/d3-collection.v1.min.js"></script>
<script src="https://d3js.org/d3-color.v1.min.js"></script>
<script src="https://d3js.org/d3-format.v1.min.js"></script>
<script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
<script src="https://d3js.org/d3-time.v1.min.js"></script>
<script src="https://d3js.org/d3-time-format.v2.min.js"></script>
<script src="https://d3js.org/d3-scale.v2.min.js"></script>

<h1> Demo of Bubble chart in D3 </h1>


<svg>
  <text x=10 y=10 >Bubble</text>
</svg>

<style>
    svg {
        width: 300px;
        height: 200px;
    }
</style>


<script>
    var x = d3.scaleLinear()
        .domain([0, 230]) // range of your raw data
        .range([10, 310]); // range of svg coordinates
    var y = d3.scaleLinear()
        .domain([0, 100]) // range of your raw data
        .range([200, 0]); // range of svg coordinates

    var xAxis = d3.axisBottom().scale(x); // Bottom means the figures lie below the axis
    var yAxis = d3.axisLeft().scale(y); // Left means the figures lie on the left side of the axis



    var svg = d3.select('svg');

    svg.append('g')
        .attr('transform', 'translate(10,180)')
        .call(xAxis) // g means group; call(xAxis) means drawing xAxis to group

    svg.append('g')
        .attr('transform', 'translate(20,0)')
        .call(yAxis)

    // svg.remove();
    var data = [{
        'height': 170,
        'weight': 70,
    }, {
        'height': 160,
        'weight': 50,
    }, {
        'height': 180,
        'weight': 70,
    }, {
        'height': 180,
        'weight': 80,
    }, {
        'height': 140,
        'weight': 40,
    }, ];

    var data2 = [{
        'height': 170,
        'weight': 70,
    }, {
        'height': 160,
        'weight': 50,
    }, {
        'height': 180,
        'weight': 70,
    }, {
        'height': 180,
        'weight': 80,
    }, {
        'height': 140,
        'weight': 80,
    }, ];




    var dataset = [
        [2001, [{
            'height': 170,
            'weight': 70,
        }, {
            'height': 160,
            'weight': 50,
        }, {
            'height': 180,
            'weight': 70,
        }, {
            'height': 180,
            'weight': 80,
        }, {
            'height': 100,
            'weight': 40,
        }, ]],
        [2002, [{
            'height': 170,
            'weight': 70,
        }, {
            'height': 160,
            'weight': 50,
        }, {
            'height': 180,
            'weight': 70,
        }, {
            'height': 180,
            'weight': 80,
        }, {
            'height': 120,
            'weight': 80,
        }, ]],
        [2003, [{
            'height': 180,
            'weight': 70,
        }, {
            'height': 170,
            'weight': 50,
        }, {
            'height': 190,
            'weight': 70,
        }, {
            'height': 200,
            'weight': 80,
        }, {
            'height': 130,
            'weight': 80,
        }, ]],
    ]

    var frameHeight = 150;

    svg
        .selectAll('circle')
        .data(dataset[0][1])
        .enter() // just enter the final position immediately
        .append('circle')
        .attr('cx', function(d) {
            return x(d['height']);
        })
        .attr('cy', function(d) {
            // console.log(d['weight'])
            // return frameHeight - d['weight'];
            return y(d['weight']);
        })
        .attr('r', function(d) {
            return d['weight'] / 10
            return Math.sqrt(d['weight']);
        })
        .attr('fill', '#ff0000')




    var keySnapshot = 0;
    d3.interval(function() {
        keySnapshot = (keySnapshot + 1) % dataset.length;
        svg
            .selectAll('circle')
            .data(dataset[keySnapshot][1])
            .transition() // show the transition process
            // .duration(300)
            .attr('cx', function(d) {
                return x(d['height']);
            })
            .attr('cy', function(d) {
                // console.log(d['weight'])
                // return frameHeight - d['weight'];
                return y(d['weight']);
            })
            .attr('r', function(d) {
                return d['weight'] / 10
                return Math.sqrt(d['weight']);
            })
            .attr('fill', '#0000ff')
    }, 1000)
</script>


<!-- // var frameHeight = 150;

    // for (i = 0; i < data.length; i++) {
    //     var x = data[i]['height'];
    //     var y = frameHeight - data[i]['weight'];
    //     svg.append('circle').attr('cx', x).attr('cy', y).attr('r', 3)
    // };

    // svg.append('circle').attr('cx', 170).attr('cy', 30).attr('r', 3)
    // svg.append('circle').attr('cx', 160).attr('cy', 50).attr('r', 3)
    // svg.append('circle').attr('cx', 180).attr('cy', 30).attr('r', 3)
    // svg.append('circle').attr('cx', 180).attr('cy', 20).attr('r', 3) -->
